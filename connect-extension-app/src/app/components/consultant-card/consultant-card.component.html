<!-- Component consultant-card -->
<ng-container *ngIf="consultant">
  <!-- Version Desktop -->
  <div *ngIf="!detailsExpanded" 
       class="hidden md:block bg-white border border-gray-200 rounded-md shadow-sm mb-2 hover:shadow-md transition-shadow duration-300 overflow-hidden cursor-pointer"
       [class.border-blue-200]="expanded" 
       [class.shadow-md]="expanded">
    
    <!-- Table Layout pour flexibilité -->
    <table class="w-full table-fixed">
      <tr>
        <!-- Colonne gauche (ID & Seniority) -->
        <td class="w-12 p-2 align-top text-center border-r border-gray-100">
          <div class="flex flex-col items-center">
            <!-- ID du consultant -->
            <span class="text-sm font-semibold tracking-tight text-gray-800" 
                 [class.text-blue-600]="expanded">
              {{ consultant.id }}
            </span>
            
            <!-- Indicateur de disponibilité -->
            <div class="mt-2 flex flex-col items-center">
              <!-- Icône de cadenas -->
              <div class="w-5 h-5 flex items-center justify-center mb-1">
                <svg *ngIf="consultant.locked" class="w-4 h-4 text-red-500" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                  <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"></path>
                </svg>
                <svg *ngIf="!consultant.locked" class="w-4 h-4 text-green-500" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                  <path d="M10 2a5 5 0 00-5 5v2a2 2 0 00-2 2v5a2 2 0 002 2h10a2 2 0 002-2v-5a2 2 0 00-2-2H7V7a3 3 0 015.905-.75 1 1 0 001.937-.5A5.002 5.002 0 0010 2z"></path>
                </svg>
              </div>
              
              <!-- Indicateur de disponibilité -->
              <div class="relative w-2 h-8 bg-gray-200 rounded-full overflow-hidden">
                <div class="absolute bottom-0 left-0 right-0 bg-green-500 rounded-full transition-all duration-300"
                     [ngStyle]="{'height': consultant.availability * 100 + '%'}">
                </div>
              </div>
              
              <!-- Barres de séniorité verticales -->
              <div class="mt-1 flex space-x-0.5">
                <div *ngFor="let bar of [].constructor(getSeniorityBars(consultant.experience)); let i = index" 
                     class="w-1 h-3 bg-blue-500 rounded-sm">
                </div>
                <div *ngFor="let bar of [].constructor(3 - getSeniorityBars(consultant.experience)); let i = index"
                     class="w-1 h-3 bg-gray-200 rounded-sm">
                </div>
              </div>
            </div>
          </div>
        </td>
        
        <!-- Colonne centrale (Infos consultant) -->
        <td class="p-2 align-top">
          <!-- Nom du rôle / poste -->
          <h3 class="font-medium text-sm text-gray-900 truncate">{{ consultant.role }}</h3>
          
          <!-- Localisation -->
          <div class="mt-1 text-xs text-gray-600">
            <span class="location-badge">{{ consultant.location }}</span>
          </div>
          
          <!-- Compétences -->
          <div class="mt-1 flex flex-wrap">
            <span *ngFor="let skill of consultant.skills.slice(0, 5)" 
                  class="inline-block px-2 py-1 text-xs font-medium text-gray-600 bg-gray-100 rounded-md mr-1 mb-1">
              {{ skill }}
            </span>
            <span *ngIf="consultant.skills.length > 5" 
                  class="inline-block px-2 py-1 text-xs font-medium text-blue-600 bg-blue-50 rounded-md">
              +{{ consultant.skills.length - 5 }}
            </span>
          </div>
          
          <!-- Message du consultant (avec gradient) -->
          <div class="relative mt-2 mb-3 overflow-hidden">
            <div class="text-sm text-gray-600 consultantMessage" [ngClass]="{'truncated': !expanded}"
                 [innerHTML]="formatMessage(consultant.message)">
            </div>
            <div *ngIf="!expanded && isMessageLong(consultant.message)" 
                 class="bg-gradient-overlay"
                 (click)="onToggleMessageExpansion(consultant.id, $event)">
            </div>
          </div>
          
          <div class="block mt-2 mb-2 text-center flex justify-center gap-2">
            <!-- Bouton pour voir tout le message (à gauche) - Affiché si message est long et non développé -->
            <button *ngIf="!expanded && isMessageLong(consultant.message)" 
                    (click)="onToggleMessageExpansion(consultant.id, $event)"
                    class="text-xs font-bold text-blue-600 hover:text-blue-800 hover:underline focus:outline-none transition-colors duration-300 mt-1 mb-1 inline-block px-2 py-1 border border-blue-300 rounded-md bg-blue-50">
              Voir tout le message
            </button>
            <!-- Bouton pour masquer le message (montré quand expanded est true) -->
            <span *ngIf="expanded">
              <button (click)="onToggleExpansion(consultant.id, $event)"
                      class="text-xs font-bold text-gray-600 hover:text-gray-800 hover:underline focus:outline-none transition-colors duration-300 mt-1 mb-1 inline-block px-2 py-1 border border-gray-300 rounded-md bg-gray-50">
                Masquer
              </button>
            </span>
            
            <!-- Bouton pour voir les détails complets (à droite) -->
            <button (click)="onToggleDetailsExpansion(consultant.id, $event)"
                    class="text-xs font-bold text-blue-600 hover:text-blue-800 hover:underline focus:outline-none transition-colors duration-300 mt-1 mb-1 inline-block px-2 py-1 border border-blue-300 rounded-md bg-blue-50">
              Voir plus
            </button>
          </div>
        </td>
        
        <!-- Colonne droite (Actions) -->
        <td class="w-12 p-2 align-top text-center">
          <div class="flex flex-col space-y-2">
            <!-- LinkedIn -->
            <button class="action-button" 
                    [disabled]="!consultant.linkedinValidated"
                    (click)="onLinkedInClick(consultant.linkedinUrl, $event)"
                    title="Voir profil LinkedIn"
                    [class.opacity-40]="!consultant.linkedinValidated">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                <path d="M6.29 18.251c7.547 0 11.675-6.253 11.675-11.675 0-.178 0-.355-.012-.53A8.348 8.348 0 0020 3.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.27 8.224 8.224 0 01-2.605.996 4.107 4.107 0 00-6.993 3.743 11.65 11.65 0 01-8.457-4.287 4.106 4.106 0 001.27 5.477A4.073 4.073 0 01.8 7.713v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233 0 010 16.407a11.616 11.616 0 006.29 1.84"></path>
              </svg>
            </button>
            
            <!-- Phone -->
            <button class="action-button" 
                    [disabled]="!consultant.phoneValidated"
                    (click)="onPhoneClick(consultant.phone, $event)"
                    title="Appeler"
                    [class.opacity-40]="!consultant.phoneValidated">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"></path>
              </svg>
            </button>
            
            <!-- Email -->
            <button class="action-button" 
                    [disabled]="!consultant.emailValidated"
                    (click)="onEmailClick(consultant.email, $event)"
                    title="Envoyer un email"
                    [class.opacity-40]="!consultant.emailValidated">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"></path>
                <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"></path>
              </svg>
            </button>
            
            <!-- More -->
            <button class="action-button relative"
                    (click)="onToggleDropdown(consultant.id, $event)"
                    title="Plus d'options">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                <path d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"></path>
              </svg>
            </button>
            
            <!-- Dropdown Menu -->
            <div *ngIf="dropdownOpen" 
                 class="absolute right-14 mt-8 w-48 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none z-10"
                 role="menu" 
                 aria-orientation="vertical" 
                 aria-labelledby="options-menu">
              <div class="py-1" role="none">
                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900" role="menuitem">Signaler un problème</a>
                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900" role="menuitem">Partager le profil</a>
                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900" role="menuitem">Ajouter aux favoris</a>
              </div>
            </div>
          </div>
        </td>
      </tr>
      
      <!-- Section étendue pour le contenu supplémentaire -->
      <tr *ngIf="expanded">
        <td colspan="3" class="bg-gray-50 p-3 border-t border-gray-200">
          <div class="text-xs text-gray-700">
            <!-- Contenu supplémentaire quand expanded est vrai -->
            <p class="mb-2 font-medium text-gray-800">
              Détails supplémentaires
            </p>
            <div class="grid grid-cols-2 gap-2">
              <div>
                <p class="font-medium">Expérience : 
                  <span class="font-normal">
                    <ng-container [ngSwitch]="consultant.experience">
                      <ng-container *ngSwitchCase="'less_than_3'">Moins de 3 ans</ng-container>
                      <ng-container *ngSwitchCase="'between_3_and_10'">3 à 10 ans</ng-container>
                      <ng-container *ngSwitchCase="'more_than_10'">Plus de 10 ans</ng-container>
                      <ng-container *ngSwitchDefault>Non spécifiée</ng-container>
                    </ng-container>
                  </span>
                </p>
              </div>
              <div>
                <p class="font-medium">Type : <span class="font-normal">{{ consultant.type }}</span></p>
              </div>
            </div>
          </div>
        </td>
      </tr>
    </table>
  </div>
  
  <!-- Vue détaillée (pour le mode "Voir plus") -->
  <div *ngIf="detailsExpanded" 
       class="hidden md:block bg-white border border-gray-200 rounded-md shadow-md mb-2 overflow-hidden">
    <div class="p-3">
      <div class="flex justify-between items-center mb-3">
        <div class="flex items-center">
          <span class="text-lg font-semibold mr-2 text-gray-800">{{ consultant.id }}</span>
          <h3 class="font-medium text-base text-gray-900">{{ consultant.role }}</h3>
        </div>
        <button (click)="onToggleDetailsExpansion(consultant.id, $event)"
                class="text-xs font-bold text-gray-600 hover:text-gray-800 focus:outline-none transition-colors duration-300 inline-block px-2 py-1 border border-gray-300 rounded-md bg-gray-50">
          Retour
        </button>
      </div>
      
      
    </div>
  </div>
  
  <!-- Version Mobile -->
  <div *ngIf="!detailsExpanded" 
       class="md:hidden mobile-consultant-card"
       [class.border-blue-200]="expanded">
    
    <!-- En-tête mobile (ID, Role, Actions) -->
    <div class="mobile-header-row">
      <div class="flex items-center">
        <!-- Status icon + ID -->
        <div class="relative mr-2">
          <span class="text-sm font-semibold tracking-tight text-gray-800">{{ consultant.id }}</span>
          <div class="absolute -top-1 -right-3">
            <svg *ngIf="consultant.locked" class="w-3 h-3 text-red-500" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"></path>
            </svg>
            <svg *ngIf="!consultant.locked" class="w-3 h-3 text-green-500" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
              <path d="M10 2a5 5 0 00-5 5v2a2 2 0 00-2 2v5a2 2 0 002 2h10a2 2 0 002-2v-5a2 2 0 00-2-2H7V7a3 3 0 015.905-.75 1 1 0 001.937-.5A5.002 5.002 0 0010 2z"></path>
            </svg>
          </div>
        </div>
        
        <!-- Role + Availability Indicator -->
        <div class="flex items-center">
          <div class="mr-2 text-sm font-medium text-gray-900 truncate max-w-[120px]">{{ consultant.role }}</div>
          <div class="flex items-center space-x-0.5">
            <div *ngFor="let bar of [].constructor(getSeniorityBars(consultant.experience)); let i = index" 
                class="w-1 h-3 bg-blue-500 rounded-sm">
            </div>
            <div *ngFor="let bar of [].constructor(3 - getSeniorityBars(consultant.experience)); let i = index"
                class="w-1 h-3 bg-gray-200 rounded-sm">
            </div>
          </div>
          <div class="ml-1 relative w-1.5 h-6 bg-gray-200 rounded-full overflow-hidden">
            <div class="absolute bottom-0 left-0 right-0 bg-green-400 rounded-full transition-all duration-300"
                [ngStyle]="{'height': consultant.availability * 100 + '%'}">
            </div>
          </div>
        </div>
      </div>
      
      <!-- Boutons d'action mobile -->
      <div class="mobile-action-buttons">
        <button class="w-7 h-7 flex items-center justify-center rounded-md bg-gray-100 text-gray-600" 
                [disabled]="!consultant.linkedinValidated"
                (click)="onLinkedInClick(consultant.linkedinUrl, $event)"
                [class.opacity-40]="!consultant.linkedinValidated">
          <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
            <path d="M6.29 18.251c7.547 0 11.675-6.253 11.675-11.675 0-.178 0-.355-.012-.53A8.348 8.348 0 0020 3.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.27 8.224 8.224 0 01-2.605.996 4.107 4.107 0 00-6.993 3.743 11.65 11.65 0 01-8.457-4.287 4.106 4.106 0 001.27 5.477A4.073 4.073 0 01.8 7.713v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233 0 010 16.407a11.616 11.616 0 006.29 1.84"></path>
          </svg>
        </button>
        
        <button class="w-7 h-7 flex items-center justify-center rounded-md bg-gray-100 text-gray-600"
                (click)="onToggleExpansion(consultant.id, $event)">
          <svg *ngIf="!expanded" class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
          </svg>
          <svg *ngIf="expanded" class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>
          </svg>
        </button>
      </div>
    </div>
    
    <!-- Contenu principal mobile -->
    <div class="mobile-info-row">
      <!-- Localisation + Compétences -->
      <div class="mb-2">
        <div class="flex items-center text-xs text-gray-600 mb-2">
          <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path>
          </svg>
          <span class="location-badge-mobile">{{ consultant.location }}</span>
        </div>
        
        <div class="flex flex-wrap mt-1">
          <span *ngFor="let skill of consultant.skills.slice(0, 3)" class="skill-badge-mobile">
            {{ skill }}
          </span>
          <span *ngIf="consultant.skills.length > 3" class="skill-badge-mobile text-blue-600 bg-blue-50">
            +{{ consultant.skills.length - 3 }}
          </span>
        </div>
      </div>
      
      <!-- Message du consultant mobile -->
      <div class="relative mt-2 mb-2 overflow-hidden">
        <div class="text-xs text-gray-600 consultantMessage" [ngClass]="{'truncated': !expanded}"
             [innerHTML]="formatMessage(consultant.message)">
        </div>
        <div *ngIf="!expanded && isMessageLong(consultant.message)" 
             class="bg-gradient-overlay-mobile"
             (click)="onToggleMessageExpansion(consultant.id, $event)">
        </div>
      </div>
      
      <div class="mt-2 text-center flex justify-center gap-2">
        <!-- Bouton "Voir tout le message" (visible si message long et non expanded) -->
        <button *ngIf="!expanded && isMessageLong(consultant.message)" 
                (click)="onToggleMessageExpansion(consultant.id, $event)"
                class="text-xs font-bold text-blue-600 hover:text-blue-800 focus:outline-none transition-colors duration-300 mt-1 mb-1 inline-block px-2 py-1 border border-blue-300 rounded-md bg-blue-50">
          Voir tout le message
        </button>
        
        <!-- Bouton "Voir plus" (pour afficher les détails) -->
        <button (click)="onToggleDetailsExpansion(consultant.id, $event)"
                class="text-xs font-bold text-blue-600 hover:text-blue-800 focus:outline-none transition-colors duration-300 mt-1 mb-1 inline-block px-2 py-1 border border-blue-300 rounded-md bg-blue-50">
          Voir plus
        </button>
      </div>
    </div>
    
    <!-- Contenu supplémentaire mobile (quand expanded est true) -->
    <div *ngIf="expanded" class="px-3 py-2 bg-gray-50 border-t border-gray-200 text-xs">
      <div class="grid grid-cols-2 gap-2">
        <div>
          <p class="font-medium">Expérience : 
            <span class="font-normal">
              <ng-container [ngSwitch]="consultant.experience">
                <ng-container *ngSwitchCase="'less_than_3'">Moins de 3 ans</ng-container>
                <ng-container *ngSwitchCase="'between_3_and_10'">3 à 10 ans</ng-container>
                <ng-container *ngSwitchCase="'more_than_10'">Plus de 10 ans</ng-container>
                <ng-container *ngSwitchDefault>Non spécifiée</ng-container>
              </ng-container>
            </span>
          </p>
        </div>
        <div>
          <p class="font-medium">Type : <span class="font-normal">{{ consultant.type }}</span></p>
        </div>
      </div>
      
      <!-- Boutons d'actions supplémentaires dans la section étendue mobile -->
      <div class="flex justify-around mt-2">
        <button class="flex items-center justify-center text-xs text-gray-600 hover:text-gray-800 transition-colors duration-300"
                [disabled]="!consultant.phoneValidated"
                (click)="onPhoneClick(consultant.phone, $event)"
                [class.opacity-40]="!consultant.phoneValidated">
          <svg class="w-3.5 h-3.5 mr-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
            <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"></path>
          </svg>
          Appeler
        </button>
        
        <button class="flex items-center justify-center text-xs text-gray-600 hover:text-gray-800 transition-colors duration-300"
                [disabled]="!consultant.emailValidated"
                (click)="onEmailClick(consultant.email, $event)"
                [class.opacity-40]="!consultant.emailValidated">
          <svg class="w-3.5 h-3.5 mr-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
            <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"></path>
            <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"></path>
          </svg>
          Email
        </button>
        
        <button class="flex items-center justify-center text-xs text-gray-600 hover:text-gray-800 transition-colors duration-300"
                (click)="onToggleDropdown(consultant.id, $event)">
          <svg class="w-3.5 h-3.5 mr-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
            <path d="M6 10a2 2 0 11-4 0 2 2 0 014 0zM12 10a2 2 0 11-4 0 2 2 0 014 0zM16 12a2 2 0 100-4 2 2 0 000 4z"></path>
          </svg>
          Plus
        </button>
      </div>
    </div>
  </div>
  
  <!-- Version Mobile Vue détaillée -->
  <div *ngIf="detailsExpanded" 
       class="md:hidden mobile-consultant-card">
    <div class="p-3">
      <div class="flex justify-between items-center mb-3">
        <div class="flex items-center">
          <span class="text-sm font-semibold mr-2 text-gray-800">{{ consultant.id }}</span>
          <h3 class="text-xs font-medium text-gray-900">{{ consultant.role }}</h3>
        </div>
        <button (click)="onToggleDetailsExpansion(consultant.id, $event)"
                class="text-xs font-bold text-gray-600 hover:text-gray-800 focus:outline-none transition-colors duration-300 inline-block px-2 py-1 border border-gray-300 rounded-md bg-gray-50">
          Retour
        </button>
      </div>
      
      
    </div>
  </div>
  
  <!-- Dropdown Menu mobile (fixed position) -->
  <div *ngIf="dropdownOpen" 
       class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-20 md:hidden"
       (click)="onToggleDropdown(consultant.id, $event)">
    <div class="w-4/5 bg-white rounded-lg shadow-lg" (click)="$event.stopPropagation()">
      <div class="p-3 border-b border-gray-200">
        <h3 class="text-sm font-medium text-gray-900">Options</h3>
      </div>
      <div class="py-2">
        <a href="#" class="block px-4 py-3 text-sm text-gray-700 hover:bg-gray-100">Signaler un problème</a>
        <a href="#" class="block px-4 py-3 text-sm text-gray-700 hover:bg-gray-100">Partager le profil</a>
        <a href="#" class="block px-4 py-3 text-sm text-gray-700 hover:bg-gray-100">Ajouter aux favoris</a>
      </div>
      <div class="p-2 border-t border-gray-200 flex justify-end">
        <button class="px-4 py-2 text-sm font-medium text-blue-600 hover:text-blue-800 focus:outline-none"
                (click)="onToggleDropdown(consultant.id, $event)">
          Fermer
        </button>
      </div>
    </div>
  </div>
</ng-container>
