<div class="add-availability-modal hidden fixed inset-0 items-center justify-center z-50">
  <div class="modal-container relative mx-auto bg-white rounded-lg shadow-xl w-11/12 md:w-4/5 lg:w-3/4 max-w-4xl max-h-[90vh] overflow-y-auto" (click)="$event.stopPropagation()">
    <!-- En-tête de la modal -->
    <div class="modal-header">
      <h2 class="text-lg font-semibold text-gray-900">Ajouter une disponibilité</h2>
      <button (click)="closeModal()" class="text-gray-500 hover:text-gray-700">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>
    
    <!-- Corps de la modal avec le formulaire -->
    <div class="modal-body">
      <form [formGroup]="availabilityForm" (ngSubmit)="onSubmit()">
        <!-- Informations principales du consultant -->
        <div class="form-section">
          <h3 class="form-section-title">Informations principales</h3>
          <div class="form-grid">
            <div class="form-group">
              <label for="role">Rôle *</label>
              <select id="role" formControlName="role" class="form-control" [class.is-invalid]="availabilityForm.get('role')?.touched && availabilityForm.get('role')?.invalid">
                <option value="">Sélectionner un rôle</option>
                <option *ngFor="let role of roleOptions" [value]="role">{{ role }}</option>
              </select>
              <div *ngIf="availabilityForm.get('role')?.touched && availabilityForm.get('role')?.invalid" class="invalid-feedback">
                Le rôle est obligatoire
              </div>
            </div>
            
            <div class="form-group">
              <label for="experienceLevel">Niveau d'expérience *</label>
              <select id="experienceLevel" formControlName="experienceLevel" class="form-control" [class.is-invalid]="availabilityForm.get('experienceLevel')?.touched && availabilityForm.get('experienceLevel')?.invalid">
                <option value="">Sélectionner un niveau</option>
                <option *ngFor="let exp of experienceOptions" [value]="exp.value">{{ exp.label }}</option>
              </select>
              <div *ngIf="availabilityForm.get('experienceLevel')?.touched && availabilityForm.get('experienceLevel')?.invalid" class="invalid-feedback">
                Le niveau d'expérience est obligatoire
              </div>
            </div>
            
            <div class="form-group">
              <label for="abbreviation">Abréviation (max 10 caractères) *</label>
              <input type="text" id="abbreviation" formControlName="abbreviation" class="form-control" [class.is-invalid]="availabilityForm.get('abbreviation')?.touched && availabilityForm.get('abbreviation')?.invalid" maxlength="10">
              <div *ngIf="availabilityForm.get('abbreviation')?.touched && availabilityForm.get('abbreviation')?.invalid" class="invalid-feedback">
                L'abréviation est obligatoire et doit faire moins de 10 caractères
              </div>
            </div>
            
            <div class="form-group">
              <label for="availabilityStatus">Statut de disponibilité *</label>
              <select id="availabilityStatus" formControlName="availabilityStatus" class="form-control" [class.is-invalid]="availabilityForm.get('availabilityStatus')?.touched && availabilityForm.get('availabilityStatus')?.invalid">
                <option value="">Sélectionner un statut</option>
                <option *ngFor="let status of availabilityOptions" [value]="status.value">{{ status.label }}</option>
              </select>
              <div *ngIf="availabilityForm.get('availabilityStatus')?.touched && availabilityForm.get('availabilityStatus')?.invalid" class="invalid-feedback">
                Le statut de disponibilité est obligatoire
              </div>
            </div>
          </div>
          
          <div class="form-grid mt-3">
            <div class="form-group">
              <label for="country">Pays *</label>
              <select id="country" formControlName="country" class="form-control" [class.is-invalid]="availabilityForm.get('country')?.touched && availabilityForm.get('country')?.invalid">
                <option value="">Sélectionner un pays</option>
                <option *ngFor="let country of countries" [value]="country">{{ country }}</option>
              </select>
              <div *ngIf="availabilityForm.get('country')?.touched && availabilityForm.get('country')?.invalid" class="invalid-feedback">
                Le pays est obligatoire
              </div>
            </div>
            
            <div class="form-group">
              <label for="cities">Villes *</label>
              <select id="cities" formControlName="cities" class="form-control" [class.is-invalid]="availabilityForm.get('cities')?.touched && availabilityForm.get('cities')?.invalid" multiple size="5">
                <option *ngFor="let city of availableCities" [value]="city">{{ city }}</option>
              </select>
              <div *ngIf="availabilityForm.get('cities')?.touched && availabilityForm.get('cities')?.invalid" class="invalid-feedback">
                Veuillez sélectionner au moins une ville
              </div>
              <small class="text-gray-500 text-xs mt-1">Maintenez Ctrl/Cmd pour sélectionner plusieurs villes</small>
            </div>
          </div>
          
          <div class="form-grid mt-3">
            <div class="form-group">
              <label for="tjm">TJM (Taux Journalier Moyen)</label>
              <input type="number" id="tjm" formControlName="tjm" class="form-control" [class.is-invalid]="availabilityForm.get('tjm')?.touched && (availabilityForm.get('tjm')?.errors?.['min'] || availabilityForm.get('tjm')?.errors?.['pattern'])">
              <div *ngIf="availabilityForm.get('tjm')?.touched && (availabilityForm.get('tjm')?.errors?.['min'] || availabilityForm.get('tjm')?.errors?.['pattern'])" class="invalid-feedback">
                Le TJM doit être un nombre positif
              </div>
            </div>
            
            <div class="form-group">
              <label for="linkedinUrl">URL LinkedIn</label>
              <input type="url" id="linkedinUrl" formControlName="linkedinUrl" class="form-control" placeholder="https://www.linkedin.com/in/votre-profil">
            </div>
          </div>
          
          <div class="form-group mt-3">
            <div class="checkbox-group">
              <input type="checkbox" id="locked" formControlName="locked">
              <label for="locked">Profil verrouillé</label>
            </div>
            <small class="text-gray-500 text-xs mt-1 block">Un profil verrouillé n'apparaît pas dans les recherches standard</small>
          </div>
        </div>
        
        <!-- Compétences -->
        <div class="form-section">
          <h3 class="form-section-title">Compétences</h3>
          <div class="form-group">
            <label>Compétences techniques</label>
            <div class="flex flex-wrap items-center gap-2 mt-1">
              <select class="form-control w-auto" #skillSelect>
                <option value="">Sélectionner dans la liste</option>
                <option *ngFor="let skill of skillsList" [value]="skill">{{ skill }}</option>
              </select>
              <button type="button" class="btn btn-secondary" (click)="addSkillFromSelect(skillSelect.value); skillSelect.value = '';">Ajouter</button>
              
              <span class="px-2 text-gray-400">ou</span>
              
              <input type="text" class="form-control w-auto" placeholder="Nouvelle compétence" #newSkillInput>
              <button type="button" class="btn btn-secondary" (click)="addSkill(newSkillInput.value); newSkillInput.value = '';">Ajouter</button>
            </div>
            
            <div *ngIf="availabilityForm.get('skills')?.value?.length > 0" class="skills-container mt-2">
              <div *ngFor="let skill of availabilityForm.get('skills')?.value; let i = index" class="skill-tag">
                {{ skill }}
                <button type="button" (click)="removeSkill(i)" title="Supprimer">
                  <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                  </svg>
                </button>
              </div>
            </div>
          </div>
          
          <!-- Secteurs d'activité -->
          <div class="form-group mt-3">
            <label>Secteurs d'activité</label>
            <div class="skills-container mt-1">
              <div *ngFor="let sector of sectors" class="checkbox-group">
                <input type="checkbox" [id]="'sector-' + sector" (change)="toggleSector(sector)" [checked]="isSectorSelected(sector)">
                <label [for]="'sector-' + sector">{{ sector }}</label>
              </div>
            </div>
          </div>
          
          <!-- Expertises -->
          <div class="form-group mt-3">
            <label>Domaines d'expertise</label>
            <div class="skills-container mt-1">
              <div *ngFor="let expertise of expertises" class="checkbox-group">
                <input type="checkbox" [id]="'expertise-' + expertise" (change)="toggleExpertise(expertise)" [checked]="isExpertiseSelected(expertise)">
                <label [for]="'expertise-' + expertise">{{ expertise }}</label>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Notes supplémentaires -->
        <div class="form-section">
          <h3 class="form-section-title">Notes supplémentaires</h3>
          <div class="form-group">
            <label for="notes">Notes (visible uniquement pour les recruteurs)</label>
            <textarea id="notes" formControlName="notes" class="form-control" rows="3"></textarea>
          </div>
        </div>
        
        <!-- Gestion de sous-traitance (pour les recruteurs) -->
        <div class="form-section">
          <div class="checkbox-group mb-3">
            <input type="checkbox" id="isSubcontractor" formControlName="isSubcontractor">
            <label for="isSubcontractor">Ce profil est proposé en sous-traitance</label>
          </div>
          
          <div *ngIf="availabilityForm.get('isSubcontractor')?.value" class="subcontractor-profiles">
            <div class="subcontractor-header">
              <h3 class="form-section-title mb-0">Profils sous-traitants associés</h3>
              <button type="button" class="btn btn-secondary" (click)="addSubcontractorProfile()">
                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                </svg>
                Ajouter un profil
              </button>
            </div>
            
            <div *ngIf="subcontractorProfiles.length === 0" class="text-gray-500 text-sm text-center py-4">
              Aucun profil sous-traitant ajouté. Cliquez sur "Ajouter un profil" pour commencer.
            </div>
            
            <div *ngFor="let profile of subcontractorProfiles.controls; let i = index" class="profile-card">
              <div class="profile-content">
                <div class="profile-card-header">
                  <h4 class="font-medium text-sm">Profil sous-traitant #{{ i + 1 }}</h4>
                  <button type="button" class="text-red-500 hover:text-red-700" (click)="removeSubcontractorProfile(i)">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                    </svg>
                  </button>
                </div>
                
                <div class="form-grid">
                  <div class="form-group">
                    <label>Nom du sous-traitant *</label>
                    <input type="text" class="form-control">
                  </div>
                  
                  <div class="form-group">
                    <label>Rôle *</label>
                    <select class="form-control">
                      <option value="">Sélectionner un rôle</option>
                      <option *ngFor="let role of roleOptions" [value]="role">{{ role }}</option>
                    </select>
                  </div>
                  
                  <div class="form-group">
                    <label>Niveau d'expérience *</label>
                    <select class="form-control">
                      <option value="">Sélectionner un niveau</option>
                      <option *ngFor="let exp of experienceOptions" [value]="exp.value">{{ exp.label }}</option>
                    </select>
                  </div>
                  
                  <div class="form-group">
                    <label>TJM</label>
                    <input type="number" class="form-control">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Message d'erreur global -->
        <div *ngIf="submitError" class="mt-3 p-3 bg-red-100 border border-red-200 text-red-700 rounded-md text-sm">
          {{ submitError }}
        </div>
        
        <!-- Boutons d'action -->
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeModal()">
            Annuler
          </button>
          <button type="submit" class="btn btn-primary" [disabled]="isSubmitting">
            <span *ngIf="isSubmitting" class="spinner"></span>
            {{ isSubmitting ? 'Enregistrement...' : 'Enregistrer' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>